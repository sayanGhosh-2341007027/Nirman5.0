<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SevaBandhu – Face Recognition Attendance</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Inter, sans-serif;
    }

    body {
        background: linear-gradient(to bottom right, #ebf5ff, #ffffff, #e8ffe8);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: auto;
    }

    .card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0px 4px 20px rgba(0,0,0,0.08);
        border: 2px solid #eee;
    }

    .grid {
        display: grid;
        gap: 20px;
    }

    .grid-2 {
        grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
    }

    video {
        width: 100%;
        border-radius: 12px;
        background: black;
    }

    button {
        padding: 14px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
    }

    .btn-primary {
        background: linear-gradient(to right, #3b82f6, #10b981);
        color: white;
    }

    .btn-outline {
        border: 2px solid black;
        background: white;
    }

    .status-box {
        text-align: center;
        padding: 30px;
    }

    .spinner {
        width: 70px;
        height: 70px;
        border: 6px solid #fff;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: auto;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .hidden { display: none; }
</style>

</head>
<body>

<div class="container">

    <!-- HEADER -->
    <div style="text-align:center; margin-bottom:30px;">
        <div style="display:flex; justify-content:center; gap:15px; align-items:center;">
            <div style="width:55px; height:55px; background:linear-gradient(to right,#3b82f6,#22c55e); border-radius:12px; display:flex; justify-content:center; align-items:center;">
                <i data-lucide="user-check" style="width:32px; height:32px; color:white;"></i>
            </div>
            <h1 style="font-size:44px; font-weight:800; background:linear-gradient(to right,#2563eb,#16a34a); -webkit-background-clip:text; color:transparent;">
                SevaBandhu
            </h1>
        </div>
        <p style="font-size:18px; color:gray; margin-top:10px;">
            Face Recognition Attendance System for Hospital Staff
        </p>
    </div>

    <!-- MAIN GRID -->
    <div class="grid grid-2">

        <!-- CAMERA CARD -->
        <div class="card">
            <h2 style="font-size:24px; font-weight:700; margin-bottom:10px;">
                <i data-lucide="camera"></i> Camera Feed
            </h2>

            <div style="position:relative; overflow:hidden; border-radius:12px; background:black;">
                <video id="video" autoplay muted playsinline></video>

                <!-- SCANNING OVERLAY -->
                <div id="scanOverlay" class="hidden"
                     style="position:absolute; inset:0; backdrop-filter:blur(4px); background:rgba(0,120,255,0.25); display:flex; flex-direction:column; align-items:center; justify-content:center;">
                    
                    <p style="margin-top:15px; color:white; font-size:20px;">Scanning Face…</p>
                </div>
            </div>

            <canvas id="canvas" style="display:none;"></canvas>

            <div style="display:flex; gap:12px; margin-top:20px;">
                
                <button id="startBtn" class="btn-primary" style="flex:1;">
                     Start Camera
                </button>

                <button id="recBtn" class="btn-primary hidden" style="flex:1;">
                    <i data-lucide="user-check"></i> Recognize Face
                </button>

                <button id="stopBtn" class="btn-outline hidden">Stop</button>
            </div>

        </div>

        <!-- STATUS CARD -->
        <div class="card">
            <h2 style="font-size:24px; font-weight:700; margin-bottom:10px;">Recognition Status</h2>

            <div id="idleStatus" class="status-box">
                <i data-lucide="user-check" style="width:100px; height:100px; opacity:0.3;"></i>
                <p style="margin-top:20px; color:gray;">Start camera and capture to recognize staff</p>
            </div>

            <div id="scanStatus" class="status-box hidden">
                <div class="spinner"></div>
                <p style="margin-top:20px; font-size:18px; color:#2563eb;">Processing facial features…</p>
            </div>

            <div id="successStatus" class="hidden">
                <div style="background:#dcfce7; padding:20px; border-radius:12px; border:2px solid #22c55e;">
                    <h3 style="font-size:24px; color:#15803d; display:flex; align-items:center; gap:10px;">
                        <i data-lucide="check-circle-2"></i> Recognition Successful!
                    </h3>

                    <div id="staffDetails" style="margin-top:15px; font-size:16px;"></div>

                    <p style="margin-top:15px; text-align:center; color:#15803d; font-weight:600;">
                        ✓ Attendance marked successfully
                    </p>
                </div>

                <button onclick="resetAll()" class="btn-outline" style="margin-top:15px; width:100%;">Scan Another</button>
            </div>

            <div id="failStatus" class="hidden">
                <div style="background:#fee2e2; padding:20px; border-radius:12px; border:2px solid #ef4444;">
                    <h3 style="font-size:24px; color:#b91c1c; display:flex; align-items:center; gap:10px;">
                        <i data-lucide="x-circle"></i> Recognition Failed
                    </h3>

                    <p style="margin-top:10px; color:#b91c1c;">Unable to identify staff member</p>

                    <ul style="margin-top:10px; color:#7f1d1d; font-size:15px;">
                        <li>Face not clearly visible</li>
                        <li>Not registered in system</li>
                        <li>Poor lighting</li>
                    </ul>
                </div>

                <button onclick="resetAll()" class="btn-outline" style="margin-top:15px; width:100%;">Try Again</button>
            </div>

        </div>
    </div>
</div>

<script>
    lucide.createIcons();

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const scanOverlay = document.getElementById("scanOverlay");

    const startBtn = document.getElementById("startBtn");
    const recBtn = document.getElementById("recBtn");
    const stopBtn = document.getElementById("stopBtn");

    const idleStatus = document.getElementById("idleStatus");
    const scanStatus = document.getElementById("scanStatus");
    const successStatus = document.getElementById("successStatus");
    const failStatus = document.getElementById("failStatus");
    const staffDetails = document.getElementById("staffDetails");

    let stream = null;

    // -----------------------
    // START CAMERA
    // -----------------------
    startBtn.onclick = async () => {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;

            startBtn.classList.add("hidden");
            recBtn.classList.remove("hidden");
            stopBtn.classList.remove("hidden");
        } catch (e) {
            alert("Camera permission denied!");
        }
    };

    // -----------------------
    // STOP CAMERA
    // -----------------------
    stopBtn.onclick = () => {
        if (stream) {
            stream.getTracks().forEach(t => t.stop());
        }

        startBtn.classList.remove("hidden");
        recBtn.classList.add("hidden");
        stopBtn.classList.add("hidden");

        resetAll();
    };

    // -----------------------
    // RECOGNIZE FACE
    // -----------------------
    recBtn.onclick = () => {
        scanOverlay.classList.remove("hidden");
        idleStatus.classList.add("hidden");
        scanStatus.classList.remove("hidden");

        setTimeout(() => {
            scanOverlay.classList.add("hidden");
            scanStatus.classList.add("hidden");

            // 70% success chance
            const success = Math.random() > 0.3;

            if (success) {
                showSuccess();
            } else {
                failStatus.classList.remove("hidden");
            }

        }, 2000);
    };

    // -----------------------
    // SHOW SUCCESS
    // -----------------------
    function showSuccess() {
        successStatus.classList.remove("hidden");

        const staff = [
            { name: "Dr. Priya Sharma", id: "DOC-2024-001", dept: "Cardiology", shift: "Morning (8 AM - 2 PM)" },
            { name: "Rajesh Kumar", id: "NUR-2024-045", dept: "ICU", shift: "Night (8 PM - 8 AM)" }
        ];

        const s = staff[Math.floor(Math.random() * staff.length)];

        staffDetails.innerHTML = `
            <p><b>Name:</b> ${s.name}</p>
            <p><b>ID:</b> ${s.id}</p>
            <p><b>Department:</b> ${s.dept}</p>
            <p><b>Shift:</b> ${s.shift}</p>
        `;
    }

    // -----------------------
    // RESET ALL
    // -----------------------
    function resetAll() {
        idleStatus.classList.remove("hidden");
        scanStatus.classList.add("hidden");
        successStatus.classList.add("hidden");
        failStatus.classList.add("hidden");
    }
</script>

</body>
</html>
