<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Understaffing Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f172a;
      padding: 16px;
    }

    .card {
      background: #0b1120;
      border-radius: 16px;
      padding: 24px 20px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .card-header {
      margin-bottom: 20px;
    }

    .title {
      font-size: 1.4rem;
      font-weight: 600;
      color: #e5e7eb;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.85rem;
      color: #e5e7eb;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input[type="number"]:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 4px;
    }

    .btn {
      margin-top: 8px;
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: white;
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.1s ease;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
      opacity: 0.9;
    }

    .status {
      margin-top: 14px;
      font-size: 0.85rem;
      min-height: 18px;
    }

    .status.info {
      color: #93c5fd;
    }

    .status.error {
      color: #fca5a5;
    }

    .result-box {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: none;
    }

    .result-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .result-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .badge {
      display: inline-block;
      margin-left: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 500;
      background: rgba(56, 189, 248, 0.12);
      color: #7dd3fc;
      border: 1px solid rgba(56, 189, 248, 0.4);
    }

    @media (max-width: 480px) {
      .card {
        padding: 20px 16px;
      }

      .title {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <div class="title">Understaffing Predictor</div>
      <div class="subtitle">
        Enter current hospital stats to predict if your staff is likely to be
        <strong>understaffed</strong>.
      </div>
    </div>

    <form id="predict-form">
      <div class="form-group">
        <label for="scheduled_shifts">Scheduled Shifts</label>
        <input
          type="number"
          id="scheduled_shifts"
          name="scheduled_shifts"
          min="0"
          required
          placeholder="e.g. 12"
        />
        <div class="hint">Total staff shifts scheduled for this time period.</div>
      </div>

      <div class="form-group">
        <label for="emergencies_count">Emergencies Count</label>
        <input
          type="number"
          id="emergencies_count"
          name="emergencies_count"
          min="0"
          required
          placeholder="e.g. 4"
        />
        <div class="hint">Number of emergency cases currently active / expected.</div>
      </div>

      <div class="form-group">
        <label for="patient_count">Patient Count</label>
        <input
          type="number"
          id="patient_count"
          name="patient_count"
          min="0"
          required
          placeholder="e.g. 40"
        />
        <div class="hint">Total number of patients being handled in this period.</div>
      </div>

      <button type="submit" class="btn">Predict</button>
    </form>

    <div id="status" class="status"></div>

    <div id="result-box" class="result-box">
      <div class="result-label">Prediction</div>
      <div class="result-value">
        <span id="result-text"></span>
        <span id="result-badge" class="badge"></span>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("predict-form");
    const statusEl = document.getElementById("status");
    const resultBox = document.getElementById("result-box");
    const resultText = document.getElementById("result-text");
    const resultBadge = document.getElementById("result-badge");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const scheduled_shifts = Number(
        document.getElementById("scheduled_shifts").value
      );
      const emergencies_count = Number(
        document.getElementById("emergencies_count").value
      );
      const patient_count = Number(
        document.getElementById("patient_count").value
      );

      statusEl.textContent = "Predicting...";
      statusEl.className = "status info";
      resultBox.style.display = "none";

      try {
        const response = await fetch("/ml/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            scheduled_shifts,
            emergencies_count,
            patient_count,
          }),
        });

        const data = await response.json();

        if (!response.ok) {
          // Backend returned error JSON
          statusEl.textContent = data.error || "Something went wrong.";
          statusEl.className = "status error";
          return;
        }

        statusEl.textContent = "";
        statusEl.className = "status";

        const prediction = Number(data.prediction); // 0/1 or any numeric code

        // You can change this logic based on how your model encodes understaffed
        if (prediction === 1) {
          resultText.textContent = "Understaffed";
          resultBadge.textContent = "Action Needed";
        } else if (prediction === 0) {
          resultText.textContent = "Adequately Staffed";
          resultBadge.textContent = "Safe";
        } else {
          resultText.textContent = `Code: ${prediction}`;
          resultBadge.textContent = "Custom Model Output";
        }

        resultBox.style.display = "block";
      } catch (err) {
        statusEl.textContent = "Network error. Check server or URL.";
        statusEl.className = "status error";
        resultBox.style.display = "none";
      }
    });
  </script>
</body>
</html>  